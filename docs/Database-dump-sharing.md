# データベースダンプファイルの共有方法

## 概要

このプロジェクトでは、データベースダンプファイル（`.tar.gz`、`.sql`）はGitで管理していません。
これは以下の理由によります：

- ファイルサイズが大きく（数百MB〜数GB）、GitHubの制限（100MB）を超える
- 頻繁に更新されるため、Gitリポジトリが肥大化する
- チーム開発において、プッシュ/プルが遅くなる

## ダンプファイルの場所

```
docker/dump/
├── .gitkeep          # ディレクトリ構造を保持
├── *.tar.gz          # Gitで追跡されない（.gitignoreで除外）
└── *.sql             # Gitで追跡されない（.gitignoreで除外）
```

## ダンプファイルの共有方法

### 方法1：クラウドストレージ（推奨）

**Google Drive、Dropbox、OneDriveなど**

1. ダンプファイルをクラウドストレージにアップロード
2. 共有リンクを作成
3. チームメンバーにリンクを共有（Slack、メールなど）

**メリット**:
- 簡単で迅速
- アクセス権限を細かく管理可能
- バージョン履歴が残る

### 方法2：社内サーバー・NAS

**ファイルサーバーやNASに保存**

```bash
# サーバーにアップロード
scp docker/dump/wordpress_dump_20260121_055015.tar.gz user@server:/shared/dumps/

# ダウンロード
scp user@server:/shared/dumps/wordpress_dump_20260121_055015.tar.gz docker/dump/
```

### 方法3：開発環境から直接エクスポート・インポート

**新しいメンバーが参加する場合**

既存メンバーの環境からダンプを作成して共有：

```bash
# 既存メンバーがダンプを作成
npm run dump

# 生成されたファイルを共有（クラウドストレージ等）
ls -lh docker/dump/*.tar.gz

# 新メンバーがダウンロードして復元
npm run restore
```

### 方法4：プロジェクトWikiやドキュメントにリンクを記載

**README.mdやWikiに最新のダンプファイルのリンクを記載**

```markdown
## 最新のデータベースダンプ

- 更新日: 2026-01-21
- ダウンロード: [Google Drive](https://drive.google.com/file/d/xxx)
- ファイル名: `wordpress_dump_20260121_055015.tar.gz`
- サイズ: 661MB
```

## ダンプファイルの使い方

### ダンプの作成

```bash
# データベースとメディアファイルをダンプ
npm run dump

# 生成されたファイル
docker/dump/wordpress_dump_YYYYMMDD_HHMMSS.tar.gz
```

### ダンプの復元

```bash
# 最新のダンプを自動選択して復元
npm run restore

# または、特定のダンプファイルを指定して復元
npm run dc:restore wordpress_dump_20260121_055015
```

## セキュリティ上の注意

### ⚠️ 本番データの取り扱い

本番環境のデータベースダンプには機密情報が含まれる可能性があります：

- ユーザーの個人情報
- メールアドレス
- パスワードハッシュ
- 非公開コンテンツ

### 推奨事項

1. **本番データは限定的に共有**
   - 必要最小限のメンバーのみアクセス可能にする
   - パスワード付きZIPやアクセス権限付きクラウドストレージを使用

2. **開発用のテストデータを用意**
   - ダミーデータを含む開発専用のダンプを作成
   - 本番データから個人情報を削除したサニタイズ版を作成

3. **定期的なクリーンアップ**
   - 古いダンプファイルは定期的に削除
   - ローカル環境に不要なダンプを残さない

## トラブルシューティング

### ダンプファイルが見つからない

**原因**: 初回セットアップ時など、ダンプファイルがまだ存在しない

**対処法**:
1. チームメンバーからダンプファイルを入手
2. または、WordPressの初期セットアップから開始

### 復元時にエラーが出る

**原因**: ダンプファイルが破損している、または古い形式

**対処法**:
```bash
# ダンプファイルの整合性を確認
tar -tzf docker/dump/wordpress_dump_20260121_055015.tar.gz

# 再度ダンプを作成してもらう
```

## Git管理について

### .gitignoreの設定

以下のファイルはGitで追跡されません：

```gitignore
# ビルド成果物
*.tar.gz

# データベース
*.sql
```

### なぜGitで管理しないのか？

- **ファイルサイズ**: 数百MB〜数GBのファイルはGitHubの制限（100MB）を超える
- **頻繁な更新**: データベースは頻繁に更新されるため、履歴が肥大化する
- **パフォーマンス**: リポジトリのクローンやプルが遅くなる
- **セキュリティ**: 機密情報を含む可能性があり、公開リポジトリには不適切

## まとめ

- ダンプファイルはGitで管理しない（`.gitignore`で除外）
- クラウドストレージや社内サーバーで共有
- 本番データは慎重に取り扱う
- 開発用のテストデータを用意することを推奨

## 関連ドキュメント

- [Database-migration-with-WP-CLI.md](Database-migration-with-WP-CLI.md) - WP-CLIを使用したデータベース移行
- [Database-migration-from-phpMyAdmin.md](Database-migration-from-phpMyAdmin.md) - phpMyAdminを使用したデータベース移行
